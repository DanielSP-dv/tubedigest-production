# Story 1.1: Disable CSRF Token for Logout Endpoint

## Status
**Current Status:** In Progress  
**Created:** 2025-08-25  
**Assigned To:** @dev.mdc  
**Priority:** High  

## Epic
Authentication & Security

## Story Number
1.1

## Title
Disable CSRF Token for Logout Endpoint

## Description
Temporarily disable CSRF token validation for the logout endpoint to resolve authentication flow issues and ensure proper logout functionality.

## Rationale
- Current logout implementation fails with 403 error due to CSRF token validation
- Frontend logout works but backend logout fails, causing user re-authentication
- CSRF protection adds complexity that's not critical for MVP phase
- Need to prioritize functionality over security complexity for initial deployment

## Acceptance Criteria
- [ ] Logout endpoint accepts requests without CSRF token validation
- [ ] Frontend logout function works without CSRF token fetching
- [ ] User can successfully log out and stay logged out
- [ ] No impact on other authenticated endpoints
- [ ] Security middleware continues to protect other state-changing operations

## Technical Requirements
- Modify security middleware to exclude logout endpoint from CSRF validation
- Update frontend logout function to remove CSRF token fetching
- Ensure logout endpoint remains protected by session validation
- Maintain CSRF protection for other POST/PUT/DELETE operations

## Implementation Tasks
1. **Backend Changes:**
   - [ ] Modify `src/modules/security/security.middleware.ts` to exclude `/api/auth/logout` from CSRF validation
   - [ ] Test that other endpoints still require CSRF tokens
   - [ ] Verify logout endpoint still validates user session

2. **Frontend Changes:**
   - [ ] Simplify `frontend/src/services/auth.ts` logout function
   - [ ] Remove CSRF token fetching logic
   - [ ] Ensure proper error handling

3. **Testing:**
   - [ ] Test logout functionality end-to-end
   - [ ] Verify user stays logged out after logout
   - [ ] Test that other authenticated operations still work
   - [ ] Verify CSRF protection still works for other endpoints

## Dependencies
- Backend security middleware
- Frontend authentication service
- Playwright testing setup

## Definition of Done
- [ ] Logout works without CSRF token errors
- [ ] User can successfully log out and stay logged out
- [ ] No regression in other authentication flows
- [ ] Code changes deployed and tested in production
- [ ] Documentation updated if needed

## Notes
- This is a temporary solution for MVP phase
- CSRF protection should be re-enabled in future iterations
- Consider implementing proper CSRF token handling for production
